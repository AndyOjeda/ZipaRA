<div class="profile-container">
  <div class="profile-header">
    <div class="avatar">
      <i class="pi pi-user"></i>
    </div>
    <h2 class="username">{{ usuario?.nombre }}</h2>

    <!-- Preferencias -->
    <div class="preferences mt-4">
      <label>
        <input type="checkbox" [(ngModel)]="preferencias.notificaciones" />
        Recibir notificaciones
      </label>
      <br />
      <label>
        <input type="checkbox" [(ngModel)]="preferencias.newsletter" />
        Suscribirse al newsletter
      </label>
    </div>
  </div>

  <div class="profile-actions">
    <button class="action-btn bg-[#B5DB0C] text-white" (click)="openAdminDialog()">
      <i class="pi pi-database"></i>
      Administrar
    </button>
    
    <button class="action-btn">
      <i class="pi pi-cog"></i>
      Configuración
    </button>

    <button class="action-btn logout" (click)="cerrarSesion()">
      <i class="pi pi-sign-out"></i>
      Cerrar sesión
    </button>
  </div>
</div>

<app-bottom-nav></app-bottom-nav>

<!-- ========== MODAL ADMIN ========== -->
<div *ngIf="showAdminDialog" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
  <div class="bg-white w-[28rem] rounded-2xl shadow-lg p-6">
    
    <!-- Título dinámico -->
    <h2 class="text-lg font-bold text-gray-800 mb-4">
      ⚙️ {{ addMode ? 'Agregar' : editMode ? 'Editar' : deleteMode ? 'Eliminar' : 'Administrar' }} {{ selectedEntity || 'entidades' }}
    </h2>

    <!-- Select entidad -->
    <label class="block text-sm text-gray-600 mb-1">Escoge una entidad</label>
    <select [(ngModel)]="selectedEntity" (change)="onEntitySelected()"
      class="w-full px-3 py-2 border rounded-lg mb-4">
      <option value="" disabled selected>Selecciona...</option>
      <option value="hoteles">Hoteles</option>
      <option value="restaurantes">Restaurantes</option>
      <option value="eventos">Eventos</option>
      <option value="actividades">Actividades</option>
      <option value="usuarios">Usuarios</option>
      <option value="categorias">Categorías</option>
    </select>

    <!-- Botones CRUD -->
    <div *ngIf="selectedEntity && !addMode && !editMode && !deleteMode && entities.length === 0"
      class="flex flex-col space-y-2">
      <button (click)="prepareAdd()" class="px-4 py-2 bg-[#B5DB0C] text-white rounded-lg">Agregar</button>
      <button (click)="fetchEntities()" class="px-4 py-2 bg-[#B5DB0C] text-white rounded-lg">Obtener</button>
      <button (click)="prepareEdit()" class="px-4 py-2 bg-[#B5DB0C] text-white rounded-lg">Editar</button>
      <button (click)="prepareDelete()" class="px-4 py-2 bg-red-600 text-white rounded-lg">Eliminar</button>
      <button (click)="closeAdminDialog()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg">Cancelar</button>
    </div>

    <!-- Obtener resultados -->
    <div *ngIf="entities.length > 0 && !addMode && !editMode && !deleteMode" class="mt-4">
      <h3 class="font-semibold">Resultados:</h3>
      <ul class="list-disc ml-6">
        <li *ngFor="let e of entities">{{ e.nombre || e.email || ('Entidad ' + e.id) }}</li>
      </ul>
      <button (click)="entities=[]" class="mt-2 px-3 py-1 bg-gray-400 text-white rounded-lg">Atrás</button>
    </div>

    <!-- Form de agregar -->
    <div *ngIf="addMode" class="mt-4 space-y-2">
      <!-- Hoteles -->
      <div *ngIf="selectedEntity === 'hoteles'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del hotel" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.direccion" placeholder="Dirección" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <select [(ngModel)]="addData.categoria_id" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
          <option [ngValue]="null" disabled selected>Selecciona categoría</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
         <label class="block text-sm font-medium text-gray-700">Imagen</label>
        <input type="file" (change)="onFileSelected($event)"
          accept="image/*"
          class="w-full px-4 py-2 border rounded-xl shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        </div>

      <!-- Restaurantes -->
      <div *ngIf="selectedEntity === 'restaurantes'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del restaurante" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.direccion" placeholder="Dirección"class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <select [(ngModel)]="addData.categoria_id" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
          <option [ngValue]="null" disabled selected>Selecciona categoría</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
        <input [(ngModel)]="addData.imagen" placeholder="URL de la imagen" class="input-field" />
      </div>

      <!-- Eventos -->
      <div *ngIf="selectedEntity === 'eventos'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del evento" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <textarea [(ngModel)]="addData.descripcion" placeholder="Descripción" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]"></textarea>
        <input [(ngModel)]="addData.fecha" type="date" class="input-field" />
        <select [(ngModel)]="addData.categoria_id" class="input-field">
          <option [ngValue]="null" disabled selected>Selecciona categoría</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
        <input [(ngModel)]="addData.imagen" placeholder="URL de la imagen" class="input-field" />
      </div>

      <!-- Actividades -->
      <div *ngIf="selectedEntity === 'actividades'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre de la actividad" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <textarea [(ngModel)]="addData.descripcion" placeholder="Descripción" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]"></textarea>
        <select [(ngModel)]="addData.categoria_id" class="input-field">
          <option [ngValue]="null" disabled selected>Selecciona categoría</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
        <input [(ngModel)]="addData.imagen" placeholder="URL de la imagen" class="input-field" />
      </div>

      <!-- Categorías -->
      <div *ngIf="selectedEntity === 'categorias'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre de la categoría" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>

      <!-- Usuarios -->
      <div *ngIf="selectedEntity === 'usuarios'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del usuario" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.email" placeholder="Correo electrónico" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>

      <button (click)="saveAdd()" class="w-full px-4 py-2 bg-[#93B306] text-white rounded-lg">Guardar</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atrás</button>
    </div>

    <!-- Editar -->
    <div *ngIf="editMode" class="mt-4">
      <label class="block mb-1 text-sm">Selecciona item</label>
      <select [(ngModel)]="selectedItemId" class="input-field mb-2">
        <option *ngFor="let e of entities" [value]="e.id">{{ e.nombre || e.email }}</option>
      </select>
      <input [(ngModel)]="editData.nombre" placeholder="Nuevo nombre" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      <button (click)="saveEdit()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg">Guardar cambios</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atrás</button>
    </div>

    <!-- Eliminar -->
    <div *ngIf="deleteMode" class="mt-4">
      <label class="block mb-1 text-sm">Selecciona item</label>
      <select [(ngModel)]="selectedItemId" class="input-field mb-2">
        <option *ngFor="let e of entities" [value]="e.id">{{ e.nombre || e.email }}</option>
      </select>
      <button (click)="deleteEntity()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg">Eliminar</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atrás</button>
    </div>
  </div>
</div>
