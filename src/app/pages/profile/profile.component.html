<div class="profile-container">
  <div class="profile-header">
    <div class="avatar">
      <i class="pi pi-user"></i>
    </div>
    <h2 class="username">{{ usuario?.nombre }}</h2>

    <!-- Preferencias -->
    <div class="preferences mt-4">
      <label>
        <input type="checkbox" [(ngModel)]="preferencias.notificaciones" />
        Recibir notificaciones
      </label>
      <br />
      <label>
        <input type="checkbox" [(ngModel)]="preferencias.newsletter" />
        Suscribirse al newsletter
      </label>
    </div>
  </div>

  <div class="profile-actions">
    <button *ngIf="usuario?.rol === 'Admin'"  class="action-btn bg-[#B5DB0C] text-white" (click)="openAdminDialog()">
      <i class="pi pi-database"></i>
      Administrar
    </button>
    
    <button class="action-btn">
      <i class="pi pi-cog"></i>
      Configuraci√≥n
    </button>

    <button class="action-btn logout" (click)="cerrarSesion()">
      <i class="pi pi-sign-out"></i>
      Cerrar sesi√≥n
    </button>
  </div>
</div>

<app-bottom-nav *ngIf="!showAdminDialog"></app-bottom-nav>

<!-- ========== MODAL ADMIN ========== -->
<div *ngIf="showAdminDialog" class="fixed inset-0 bg-transparent bg-opacity-50 flex justify-center items-start overflow-y-auto z-50 p-6">
  <div class="bg-white w-full max-w-4xl rounded-2xl shadow-2xl p-8 animate-fadeIn">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800">
        {{ addMode ? 'Agregar' : editMode ? 'Editar' : deleteMode ? 'Eliminar' : 'Administrar' }} {{ selectedEntity || 'entidades' }}
      </h2>
      <button (click)="closeAdminDialog()" class="text-gray-500 hover:text-gray-800 text-xl">
        ‚úñ
      </button>
    </div>

    <!-- Select entidad -->
    <label class="block text-sm text-gray-600 mb-2 font-medium">Escoge una entidad</label>
    <select [(ngModel)]="selectedEntity" (change)="onEntitySelected()"
      class="w-full px-4 py-3 border rounded-lg mb-6 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
      <option value="" disabled selected>Selecciona...</option>
      <option value="hoteles">Hoteles</option>
      <option value="restaurantes">Restaurantes</option>
      <option value="eventos">Eventos</option>
      <option value="actividades">Actividades</option>
      <option value="usuarios">Usuarios</option>
      <option value="categorias">Categor√≠as</option>
    </select>

    <!-- Botones CRUD -->
    <div class="max-h-[70vh] overflow-y-auto pr-2" *ngIf="selectedEntity && !addMode && !editMode && !deleteMode && entities.length === 0">
<div class="flex flex-col space-y-3 mt-1">
  <button (click)="prepareAdd()" class="w-full py-2 bg-[#B5DB0C] text-white rounded-lg font-medium shadow hover:bg-[#9ac70a] transition">Agregar</button>
  <button (click)="fetchEntities()" class="w-full py-2 bg-blue-500 text-white rounded-lg font-medium shadow hover:bg-blue-600 transition">Obtener</button>
  <button (click)="prepareEdit()" class="w-full py-2 bg-yellow-400 text-gray-900 rounded-lg font-medium shadow hover:bg-yellow-500 transition">Editar</button>
  <button (click)="prepareDelete()" class="w-full py-2 bg-red-500 text-white rounded-lg font-medium shadow hover:bg-red-600 transition">Eliminar</button>
</div>


      <!-- Mensaje de carga -->
      <div *ngIf="loadingMessage"  
        class="mb-4 flex items-center p-3 rounded-lg bg-blue-100 text-blue-700 text-sm font-medium">
        <svg class="w-5 h-5 mr-2 text-blue-600 animate-spin" fill="none" stroke="currentColor" stroke-width="2"
          viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-opacity="0.25" stroke-width="4"></circle>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
            d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 01-8 8z"/>
        </svg>
        {{ loadingMessage }}
      </div>

      <!-- Mensaje √©xito -->
      <div *ngIf="successMessage"  
        class="mb-4 mt-4 p-3 rounded-lg bg-green-100 text-green-700 text-sm font-medium">
        ‚úÖ {{ successMessage }}
      </div>

      <!-- Mensaje error -->
      <div *ngIf="errorMessage"  
        class="mb-4 mt-4 p-3 rounded-lg bg-red-100 text-red-700 text-sm font-medium">
        ‚ùå {{ errorMessage }}
      </div>
      
    </div>

    <!-- Obtener resultados -->
    <div *ngIf="entities.length > 0 && !addMode && !editMode && !deleteMode" class="mt-4">
      <h3 class="font-semibold">Resultados:</h3>
      <ul class="list-disc ml-6">
        <li *ngFor="let e of entities">{{ e.nombre || e.email || ('Entidad ' + e.id) }}</li>
      </ul>
      <button (click)="entities=[]" class="mt-2 px-3 py-1 bg-gray-400 text-white rounded-lg">Atr√°s</button>
    </div>

    <!-- Form de agregar -->
    <div *ngIf="addMode" class="mt-4 space-y-2">
      
    <!-- HOTELES -->

    <div *ngIf="selectedEntity === 'hoteles'">
      <input [(ngModel)]="addData.nombre" placeholder="Nombre del hotel" 
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />

      <input [(ngModel)]="addData.direccion" placeholder="Direcci√≥n" 
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />

      <select [(ngModel)]="addData.categoria_id" 
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
        <option [ngValue]="null" disabled selected>Selecciona categor√≠a</option>
        <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
      </select>

      <!-- üìå Nuevo campo: descripci√≥n -->
      <textarea [(ngModel)]="addData.descripcion" placeholder="Descripci√≥n" 
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]"></textarea>

      <!-- üìå Nuevo campo: precio -->
      <input type="number" [(ngModel)]="addData.precio" placeholder="Precio por noche"
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />

      <!-- üìå Nuevo campo: comodidades (botones toggle) -->
      <label class="block text-sm font-medium text-gray-700 mb-2">Comodidades</label>
      <div class="grid grid-cols-2 gap-2">
        <button 
          *ngFor="let c of availableComodidades"
          (click)="toggleComodidad(c)"
          [class.bg-[#B5DB0C]]="addData.comodidades[c]"
          [class.text-white]="addData.comodidades[c]"
          class="px-3 py-2 border rounded-lg transition duration-200"
        >
          {{ c }}
        </button>
      </div>


      <!-- Imagen -->
      <label class="block text-sm font-medium text-gray-700">Imagen</label>
      <input type="file" (change)="onFileSelected($event)" accept="image/*"
        class="w-full px-4 py-2 border rounded-xl shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>


      <!-- Restaurantes -->
      <div *ngIf="selectedEntity === 'restaurantes'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del restaurante" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.direccion" placeholder="Direcci√≥n"class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <select [(ngModel)]="addData.categoria_id" 
          class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
          <option [ngValue]="null" disabled selected>Selecciona categor√≠a</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
          <!-- Imagen -->
        <label class="block text-sm font-medium text-gray-700 mb-1">Imagen</label>
        <input type="file" (change)="onFileSelected($event)" accept="image/*"
          class="w-full px-4 py-2 border rounded-xl shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#B5DB0C] mb-4" />
        </div>
      
    

      <!-- Eventos -->
      <div *ngIf="selectedEntity === 'eventos'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del evento" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.direccion" placeholder="Direcci√≥n" 
        class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <textarea [(ngModel)]="addData.descripcion" placeholder="Descripci√≥n" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]"></textarea>
        <input [(ngModel)]="addData.fecha" type="date" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <select [(ngModel)]="addData.categoria_id" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
          <option [ngValue]="null" disabled selected>Selecciona categor√≠a</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
      <!-- Imagen -->
      <label class="block text-sm font-medium text-gray-700">Imagen</label>
      <input type="file" (change)="onFileSelected($event)" accept="image/*"
        class="w-full px-4 py-2 border rounded-xl shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>

      <!-- Actividades -->
      <div *ngIf="selectedEntity === 'actividades'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre de la actividad" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.direccion" placeholder="Direcci√≥n"class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.fecha" type="date" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
                <input [(ngModel)]="addData.horario" placeholder="Horario"class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <textarea [(ngModel)]="addData.descripcion" placeholder="Descripci√≥n" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]"></textarea>
        <select [(ngModel)]="addData.categoria_id" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]">
          <option [ngValue]="null" disabled selected>Selecciona categor√≠a</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
        </select>
         <!-- Imagen -->
        <label class="block text-sm font-medium text-gray-700 mb-1">Imagen</label>
        <input type="file" (change)="onFileSelected($event)" accept="image/*"
          class="w-full px-4 py-2 border rounded-xl shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-[#B5DB0C] mb-4" />
      </div>

      <!-- Categor√≠as -->
      <div *ngIf="selectedEntity === 'categorias'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre de la categor√≠a" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>

      <!-- Usuarios -->
      <div *ngIf="selectedEntity === 'usuarios'">
        <input [(ngModel)]="addData.nombre" placeholder="Nombre del usuario" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
        <input [(ngModel)]="addData.email" placeholder="Correo electr√≥nico" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      </div>

      <button (click)="saveAdd()" class="w-full px-4 py-2 bg-[#93B306] text-white rounded-lg mb-2">Guardar</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atr√°s</button>
    </div>

    <!-- Editar -->
    <div *ngIf="editMode" class="mt-4">
      <label class="block mb-1 text-sm">Selecciona item</label>
      <select [(ngModel)]="selectedItemId" class="input-field mb-2">
        <option *ngFor="let e of entities" [value]="e.id">{{ e.nombre || e.email }}</option>
      </select>
      <input [(ngModel)]="editData.nombre" placeholder="Nuevo nombre" class="w-full px-4 py-2 border rounded-xl shadow-sm mb-3 focus:outline-none focus:ring-2 focus:ring-[#B5DB0C]" />
      <button (click)="saveEdit()" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg">Guardar cambios</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atr√°s</button>
    </div>

    <!-- Eliminar -->
    <div *ngIf="deleteMode" class="mt-4">
      <label class="block mb-1 text-sm">Selecciona item</label>
      <select [(ngModel)]="selectedItemId" class="input-field mb-2">
        <option *ngFor="let e of entities" [value]="e.id">{{ e.nombre || e.email }}</option>
      </select>
      <button (click)="deleteEntity()" class="w-full px-4 py-2 bg-red-600 text-white rounded-lg">Eliminar</button>
      <button (click)="resetModes()" class="w-full px-4 py-2 bg-gray-400 text-white rounded-lg">Atr√°s</button>
    </div>
  </div>
</div>
